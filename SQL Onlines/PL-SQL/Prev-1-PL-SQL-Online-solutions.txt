1.
CREATE OR REPLACE PROCEDURE CALC_RANK(N IN NUMBER, M IN NUMBER, M_ID IN VARCHAR2,RET OUT NUMBER) IS
	
	COUNTER NUMBER;
	
BEGIN 
	
	COUNTER := 1;
	
	FOR R IN (
		SELECT E1.EMPLOYEE_ID, (E1.FIRST_NAME || ' ' || E1.LAST_NAME) AS FULL_NAME, COUNT(E2.EMPLOYEE_ID) AS CNT, AVG(E2.SALARY) AS AVG_SAL
		FROM EMPLOYEES E1 LEFT OUTER JOIN EMPLOYEES E2 
		ON (E2.MANAGER_ID = E1.EMPLOYEE_ID)
		GROUP BY E1.EMPLOYEE_ID, E1.FIRST_NAME, E1.LAST_NAME
		HAVING COUNT(E2.EMPLOYEE_ID) > N AND AVG(E2.SALARY) < M
		ORDER BY AVG(E2.SALARY)
	)
	LOOP 
	
		IF R.EMPLOYEE_ID = M_ID THEN 
		
			RET := COUNTER;
			
		END IF;
	
	
		DBMS_OUTPUT.PUT_LINE(R.FULL_NAME || ' RANK = ' || COUNTER || ', AVG_SALARY = '|| R.AVG_SAL);
		COUNTER := COUNTER + 1;
		
	END LOOP;
	
EXCEPTION 

	WHEN OTHERS THEN 
		DBMS_OUTPUT.PUT_LINE('Unknown Error Occurred');
	
END;
/

DECLARE 
	
	RNK NUMBER;
	
BEGIN 
	
	CALC_RANK(5,5000,123,RNK);
	DBMS_OUTPUT.PUT_LINE('REQUIRED RANK = ' || RNK);
	
END;
/

2.

